<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>T^2 and SPE control charts for multivariate functional data — control_charts_pca • funcharts</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="T^2 and SPE control charts for multivariate functional data — control_charts_pca" />
<meta property="og:description" content="This function builds a data frame needed to plot
the Hotelling's T^2 and squared prediction error (SPE)
control charts
based on multivariate functional principal component analysis
(MFPCA) performed
on multivariate functional data,
proposed in Capezza et al. (2020) together with the scalar control chart
and used also to build the
functional regression control chart proposed in Centofanti et al. (2020)
(this function is used by regr_cc_fof).
The training data have already been used to fit the model.
A tuning data set can be provided that is used to estimate
the control chart limits.
A phase II data set contains the observations
to be monitored with the built control charts." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funcharts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/capezza2020.html">capezza2020</a>
    </li>
    <li>
      <a href="../articles/centofanti2020.html">centofanti2020</a>
    </li>
    <li>
      <a href="../articles/mfd.html">mfd</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/unina-sfere/funcharts/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>T^2 and SPE control charts for multivariate functional data</h1>
    <small class="dont-index">Source: <a href='https://github.com/unina-sfere/funcharts/blob/master/R/04_phaseII.R'><code>R/04_phaseII.R</code></a></small>
    <div class="hidden name"><code>control_charts_pca.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function builds a data frame needed to plot
the Hotelling's T^2 and squared prediction error (SPE)
control charts
based on multivariate functional principal component analysis
(MFPCA) performed
on multivariate functional data,
proposed in Capezza et al. (2020) together with the scalar control chart
and used also to build the
functional regression control chart proposed in Centofanti et al. (2020)
(this function is used by <code><a href='regr_cc_fof.html'>regr_cc_fof</a></code>).
The training data have already been used to fit the model.
A tuning data set can be provided that is used to estimate
the control chart limits.
A phase II data set contains the observations
to be monitored with the built control charts.</p>
    </div>

    <pre class="usage"><span class='fu'>control_charts_pca</span><span class='op'>(</span>
  <span class='va'>pca</span>,
  <span class='va'>components</span>,
  tuning_data <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>newdata</span>,
  alpha <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>T2 <span class='op'>=</span> <span class='fl'>0.025</span>, spe <span class='op'>=</span> <span class='fl'>0.025</span><span class='op'>)</span>,
  limits <span class='op'>=</span> <span class='st'>"standard"</span>,
  seed <span class='op'>=</span> <span class='fl'>0</span>,
  nfold <span class='op'>=</span> <span class='fl'>5</span>,
  ncores <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pca</th>
      <td><p>An object of class <code>pca_mfd</code>
obtained by doing MFPCA on the
training set of multivariate functional data.</p></td>
    </tr>
    <tr>
      <th>components</th>
      <td><p>A vector of integers with the components over which
to project the multivariate functional data.</p></td>
    </tr>
    <tr>
      <th>tuning_data</th>
      <td><p>An object of class <code>mfd</code> containing
the tuning set of the multivariate functional data, used to estimate the
T^2 and SPE control chart limits.
If NULL, the training data, i.e. the data used to fit the MFPCA model,
are also used as the tuning data set, i.e. <code>tuning_data=pca$data</code>.
Default is NULL.</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>An object of class <code>mfd</code> containing
the phase II set of the multivariate functional data to be monitored.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>A named list with two elements, named <code>T2</code> and <code>spe</code>,
respectively, each containing
the desired Type I error probability of
the corresponding control chart.
Note that at the moment you have to take into account manually
the family-wise error rate and adjust
the two values accordingly. See Capezza et al. (2020) and
Centofanti et al. (2020)
for additional details. Default value is
<code><a href='https://rdrr.io/r/base/list.html'>list(T2 = 0.025, spe = 0.025)</a></code>.</p></td>
    </tr>
    <tr>
      <th>limits</th>
      <td><p>A character value.
If "standard", it estimates the control limits on the tuning
data set. If "cv", the function calculates the control limits only on the
training data using cross-validation
using <code>calculate_cv_limits</code>. Default is "standard".</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>If <code>limits=="cv"</code>,
since the split in the k groups is random,
you can fix a seed to ensure reproducibility.
Otherwise, this argument is ignored.</p></td>
    </tr>
    <tr>
      <th>nfold</th>
      <td><p>If <code>limits=="cv"</code>, this gives the number of groups k
used for k-fold cross-validation.
If it is equal to the number of observations in the training data set,
then we have
leave-one-out cross-validation.
Otherwise, this argument is ignored.</p></td>
    </tr>
    <tr>
      <th>ncores</th>
      <td><p>If <code>limits=="cv"</code>, if you want perform the analysis
in the k groups in parallel,
give the number of cores/threads.
Otherwise, this argument is ignored.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>data.frame</code> with as many rows as the number of
multivariate functional observations in the phase II data set and
the following columns:</p>
<p>* one <code>id</code> column identifying the multivariate functional observation
in the phase II data set,</p>
<p>* one <code>T2</code> column containing the Hotelling T^2 statistic
calculated for all observations,</p>
<p>* one column per each functional variable,
containing its contribution to the T^2 statistic,</p>
<p>* one <code>spe</code> column containing the SPE statistic calculated
for all observations,</p>
<p>* one column per each functional variable,
containing its contribution to the SPE statistic,</p>
<p>* <code>T2_lim</code> gives the upper control limit of
the Hotelling's T^2 control chart,</p>
<p>* one <code>contribution_T2_*_lim</code> column per each
functional variable giving the
limits of the contribution of that variable
to the Hotelling's T^2 statistic,</p>
<p>* <code>spe_lim</code> gives the upper control limit of the SPE control chart</p>
<p>* one <code>contribution_spe*_lim</code> column per each
functional variable giving the
limits of the contribution of that variable to the SPE statistic.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Capezza C, Lepore A, Menafoglio A, Palumbo B, Vantini S. (2020)
Control charts for
monitoring ship operating conditions and CO2 emissions
based on scalar-on-function regression.
<em>Applied Stochastic Models in Business and Industry</em>,
36(3):477--500.
&lt;doi:10.1002/asmb.2507&gt;</p>
<p>Centofanti F, Lepore A, Menafoglio A, Palumbo B, Vantini S. (2020)
Functional Regression Control Chart.
<em>Technometrics</em>. &lt;doi:10.1080/00401706.2020.1753581&gt;</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='regr_cc_fof.html'>regr_cc_fof</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/unina-sfere/funcharts'>funcharts</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"air"</span><span class='op'>)</span>
<span class='va'>air</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>air</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>220</span>, , drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>fun_covariates</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CO"</span>, <span class='st'>"temperature"</span><span class='op'>)</span>
<span class='va'>mfdobj_x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_mfd_list.html'>get_mfd_list</a></span><span class='op'>(</span><span class='va'>air</span><span class='op'>[</span><span class='va'>fun_covariates</span><span class='op'>]</span>,
                         n_basis <span class='op'>=</span> <span class='fl'>15</span>,
                         lambda <span class='op'>=</span> <span class='fl'>1e-2</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>air</span><span class='op'>$</span><span class='va'>NO2</span><span class='op'>)</span>
<span class='va'>y1</span> <span class='op'>&lt;-</span> <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>]</span>
<span class='va'>y_tuning</span> <span class='op'>&lt;-</span> <span class='va'>y</span><span class='op'>[</span><span class='fl'>101</span><span class='op'>:</span><span class='fl'>200</span><span class='op'>]</span>
<span class='va'>y2</span> <span class='op'>&lt;-</span> <span class='va'>y</span><span class='op'>[</span><span class='fl'>201</span><span class='op'>:</span><span class='fl'>220</span><span class='op'>]</span>
<span class='va'>mfdobj_x1</span> <span class='op'>&lt;-</span> <span class='va'>mfdobj_x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>]</span>
<span class='va'>mfdobj_x_tuning</span> <span class='op'>&lt;-</span> <span class='va'>mfdobj_x</span><span class='op'>[</span><span class='fl'>101</span><span class='op'>:</span><span class='fl'>200</span><span class='op'>]</span>
<span class='va'>mfdobj_x2</span> <span class='op'>&lt;-</span> <span class='va'>mfdobj_x</span><span class='op'>[</span><span class='fl'>201</span><span class='op'>:</span><span class='fl'>220</span><span class='op'>]</span>
<span class='va'>pca</span> <span class='op'>&lt;-</span> <span class='fu'><a href='pca_mfd.html'>pca_mfd</a></span><span class='op'>(</span><span class='va'>mfdobj_x1</span><span class='op'>)</span>
<span class='va'>components</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>pca</span><span class='op'>$</span><span class='va'>varprop</span><span class='op'>)</span> <span class='op'>&gt;=</span> <span class='fl'>.90</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='va'>cclist</span> <span class='op'>&lt;-</span> <span class='fu'>control_charts_pca</span><span class='op'>(</span>pca <span class='op'>=</span> <span class='va'>pca</span>,
                             components <span class='op'>=</span> <span class='va'>components</span>,
                             tuning_data <span class='op'>=</span> <span class='va'>mfdobj_x_tuning</span>,
                             newdata <span class='op'>=</span> <span class='va'>mfdobj_x2</span><span class='op'>)</span>
<span class='fu'><a href='plot_control_charts.html'>plot_control_charts</a></span><span class='op'>(</span><span class='va'>cclist</span><span class='op'>)</span>
</div><div class='img'><img src='control_charts_pca-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christian Capezza, Fabio Centofanti, Antonio Lepore, Alessandra Menafoglio, Biagio Palumbo, Simone Vantini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


