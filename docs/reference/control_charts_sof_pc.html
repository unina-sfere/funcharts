<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Control charts for monitoring a scalar quality characteristic adjusted for
by the effect of multivariate functional covariates — control_charts_sof_pc • funcharts</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Control charts for monitoring a scalar quality characteristic adjusted for
by the effect of multivariate functional covariates — control_charts_sof_pc"><meta property="og:description" content="This function builds a data frame needed to
plot control charts
for monitoring a monitoring a scalar quality characteristic adjusted for
the effect of multivariate functional covariates based on
scalar-on-function regression,
as proposed in Capezza et al. (2020).
In particular, this function provides:
* the Hotelling's T^2 control chart,
* the squared prediction error (SPE) control chart,
* the scalar regression control chart.
This function calls control_charts_pca for the control charts on
the multivariate functional covariates and regr_cc_sof
for the scalar regression control chart.
The training data have already been used to fit the model.
An optional tuning data set can be provided that is used to estimate
the control chart limits.
A phase II data set contains the observations to be monitored
with the control charts."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funcharts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/capezza2020.html">capezza2020</a>
    </li>
    <li>
      <a href="../articles/centofanti2021.html">centofanti2021</a>
    </li>
    <li>
      <a href="../articles/colosimo2010.html">colosimo2010</a>
    </li>
    <li>
      <a href="../articles/mfd.html">mfd</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/unina-sfere/funcharts/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Control charts for monitoring a scalar quality characteristic adjusted for
by the effect of multivariate functional covariates</h1>
    <small class="dont-index">Source: <a href="https://github.com/unina-sfere/funcharts/blob/HEAD/R/04_phaseII.R" class="external-link"><code>R/04_phaseII.R</code></a></small>
    <div class="hidden name"><code>control_charts_sof_pc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function builds a data frame needed to
plot control charts
for monitoring a monitoring a scalar quality characteristic adjusted for
the effect of multivariate functional covariates based on
scalar-on-function regression,
as proposed in Capezza et al. (2020).</p>
<p>In particular, this function provides:</p>
<p>* the Hotelling's T^2 control chart,</p>
<p>* the squared prediction error (SPE) control chart,</p>
<p>* the scalar regression control chart.</p>
<p>This function calls <code>control_charts_pca</code> for the control charts on
the multivariate functional covariates and <code><a href="regr_cc_sof.html">regr_cc_sof</a></code>
for the scalar regression control chart.</p>
<p>The training data have already been used to fit the model.
An optional tuning data set can be provided that is used to estimate
the control chart limits.
A phase II data set contains the observations to be monitored
with the control charts.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">control_charts_sof_pc</span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  <span class="va">y_test</span>,</span>
<span>  <span class="va">mfdobj_x_test</span>,</span>
<span>  mfdobj_x_tuning <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>T2 <span class="op">=</span> <span class="fl">0.0125</span>, spe <span class="op">=</span> <span class="fl">0.0125</span>, y <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  limits <span class="op">=</span> <span class="st">"standard"</span>,</span>
<span>  <span class="va">seed</span>,</span>
<span>  nfold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mod</dt>
<dd><p>A list obtained as output from <code>sof_pc</code>,
i.e. a fitted scalar-on-function linear regression model.</p></dd>


<dt>y_test</dt>
<dd><p>A numeric vector containing the observations
of the scalar response variable
in the phase II data set.</p></dd>


<dt>mfdobj_x_test</dt>
<dd><p>An object of class <code>mfd</code> containing
the phase II data set of the functional covariates observations.</p></dd>


<dt>mfdobj_x_tuning</dt>
<dd><p>An object of class <code>mfd</code> containing
the tuning set of the multivariate functional data, used to estimate the
T^2 and SPE control chart limits.
If NULL, the training data, i.e. the data used to fit the MFPCA model,
are also used as the tuning data set, i.e. <code>tuning_data=pca$data</code>.
Default is NULL.</p></dd>


<dt>alpha</dt>
<dd><p>A named list with three elements, named <code>T2</code>, <code>spe</code>,
and codey,
respectively, each containing
the desired Type I error probability of the corresponding control chart
(<code>T2</code> corresponds to the T^2 control chart,
<code>spe</code>  corresponds to the SPE control chart,
<code>y</code> corresponds to the scalar regression control chart).
Note that at the moment you have to take into account manually
the family-wise error rate and adjust
the two values accordingly. See Capezza et al. (2020)
for additional details. Default value is
<code>list(T2 = 0.0125, spe = 0.0125, y = 0.025)</code>.</p></dd>


<dt>limits</dt>
<dd><p>A character value.
If "standard", it estimates the control limits on the tuning
data set. If "cv", the function calculates the control limits only on the
training data using cross-validation
using <code>calculate_cv_limits</code>. Default is "standard".</p></dd>


<dt>seed</dt>
<dd><p>If <code>limits=="cv"</code>,
since the split in the k groups is random,
you can fix a seed to ensure reproducibility.
Deprecated: use <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> before calling
the function for reproducibility.</p></dd>


<dt>nfold</dt>
<dd><p>If <code>limits=="cv"</code>, this gives the number of groups k
used for k-fold cross-validation.
If it is equal to the number of observations in the training data set,
then we have
leave-one-out cross-validation.
Otherwise, this argument is ignored.</p></dd>


<dt>ncores</dt>
<dd><p>If <code>limits=="cv"</code>, if you want perform the analysis
in the k groups in parallel,
give the number of cores/threads.
Otherwise, this argument is ignored.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>data.frame</code> with as many rows as the number of
multivariate functional observations in the phase II data set and
the following columns:</p>


<p>* one <code>id</code> column identifying the multivariate functional observation
in the phase II data set,</p>


<p>* one <code>T2</code> column containing the Hotelling T^2 statistic calculated
for all observations,</p>


<p>* one column per each functional variable, containing its contribution
to the T^2 statistic,</p>


<p>* one <code>spe</code> column containing the SPE statistic calculated
for all observations,</p>


<p>* one column per each functional variable, containing its contribution
to the SPE statistic,</p>


<p>* <code>T2_lim</code> gives the upper control limit of the
Hotelling's T^2 control chart,</p>


<p>* one <code>contribution_T2_*_lim</code> column per each
functional variable giving the
limits of the contribution of that variable to the
Hotelling's T^2 statistic,</p>


<p>* <code>spe_lim</code> gives the upper control limit of the SPE control chart</p>


<p>* one <code>contribution_spe*_lim</code> column per
each functional variable giving the
limits of the contribution of that variable to the SPE statistic.</p>


<p>* <code>y_hat</code>: the predictions of the response variable
corresponding to <code>mfdobj_x_new</code>,</p>


<p>* <code>y</code>: the same as the argument <code>y_new</code></p>


<p>given as input to this function,</p>


<p>* <code>lwr</code>: lower limit of the <code>1-alpha</code></p>


<p>prediction interval on the response,</p>


<p>* <code>pred_err</code>: prediction error calculated as <code>y-y_hat</code>,</p>


<p>* <code>pred_err_sup</code>: upper limit of the <code>1-alpha</code></p>


<p>prediction interval on the prediction error,</p>


<p>* <code>pred_err_inf</code>: lower limit of the <code>1-alpha</code></p>


<p>prediction interval on the prediction error.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="control_charts_pca.html">control_charts_pca</a></code>, <code><a href="regr_cc_sof.html">regr_cc_sof</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#' library(funcharts)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"air"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">air</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">air</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fun_covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CO"</span>, <span class="st">"temperature"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mfdobj_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_mfd_list.html">get_mfd_list</a></span><span class="op">(</span><span class="va">air</span><span class="op">[</span><span class="va">fun_covariates</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                         n_basis <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>                         lambda <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">air</span><span class="op">$</span><span class="va">NO2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">91</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mfdobj_x1</span> <span class="op">&lt;-</span> <span class="va">mfdobj_x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mfdobj_x_tuning</span> <span class="op">&lt;-</span> <span class="va">mfdobj_x</span><span class="op">[</span><span class="fl">61</span><span class="op">:</span><span class="fl">90</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mfdobj_x2</span> <span class="op">&lt;-</span> <span class="va">mfdobj_x</span><span class="op">[</span><span class="fl">91</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="sof_pc.html">sof_pc</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">mfdobj_x1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cclist</span> <span class="op">&lt;-</span> <span class="fu">control_charts_sof_pc</span><span class="op">(</span>mod <span class="op">=</span> <span class="va">mod</span>,</span></span>
<span class="r-in"><span>                                y_test <span class="op">=</span> <span class="va">y2</span>,</span></span>
<span class="r-in"><span>                                mfdobj_x_test <span class="op">=</span> <span class="va">mfdobj_x2</span>,</span></span>
<span class="r-in"><span>                                mfdobj_x_tuning <span class="op">=</span> <span class="va">mfdobj_x_tuning</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_control_charts.html">plot_control_charts</a></span><span class="op">(</span><span class="va">cclist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christian Capezza, Fabio Centofanti, Antonio Lepore, Alessandra Menafoglio, Biagio Palumbo, Simone Vantini.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

